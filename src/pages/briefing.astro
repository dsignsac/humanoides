---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Briefing | Humanoides & Asociados" showPreloader={false}>
  <main
    class="min-h-screen bg-brand-gray text-brand-black pt-32 pb-20 px-6 overflow-hidden"
  >
    <div class="max-w-5xl mx-auto relative px-4">
      <!-- Progress Bar -->
      <div class="w-full h-1 bg-brand-black/5 mb-16 relative overflow-hidden">
        <div
          id="progress-bar"
          class="absolute top-0 left-0 h-full bg-brand-red w-1/4 transition-all duration-700 ease-in-out"
        >
        </div>
      </div>

      <!-- Step Container -->
      <div id="steps-wrapper" class="relative">
        <!-- STEP 1: El Negocio -->
        <section class="step active opacity-100" data-step="1">
          <div class="mb-12">
            <h2
              class="text-5xl md:text-8xl font-sans font-900 tracking-tighter leading-none"
            >
              Háblanos de<br /><span class="text-brand-red">tu negocio</span>
            </h2>
            <p
              class="text-xs font-sans font-bold mt-6 opacity-40 tracking-wider"
            >
              Paso 01 / 04
            </p>
          </div>

          <div class="space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <input
                type="text"
                id="field-empresa"
                name="empresa"
                placeholder="Nombre de la empresa o proyecto *"
                class="w-full border-b-2 border-brand-black/10 p-6 bg-transparent font-sans text-lg outline-none focus:border-brand-red transition-colors"
              />
              <input
                type="text"
                id="field-rubro"
                name="rubro"
                placeholder="Rubro / Industria"
                class="w-full border-b-2 border-brand-black/10 p-6 bg-transparent font-sans text-lg outline-none focus:border-brand-red transition-colors"
              />
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <input
                type="text"
                id="field-email"
                name="email"
                placeholder="Email de contacto *"
                class="w-full border-b-2 border-brand-black/10 p-6 bg-transparent font-sans text-lg outline-none focus:border-brand-red transition-colors"
              />
              <input
                type="text"
                id="field-telefono"
                name="telefono"
                placeholder="Teléfono / WhatsApp *"
                class="w-full border-b-2 border-brand-black/10 p-6 bg-transparent font-sans text-lg outline-none focus:border-brand-red transition-colors"
              />
            </div>
          </div>
        </section>

        <!-- STEP 2: Servicios -->
        <section
          class="step opacity-0 pointer-events-none hidden"
          data-step="2"
        >
          <div class="mb-12">
            <h2
              class="text-5xl md:text-8xl font-sans font-900 tracking-tighter leading-none"
            >
              ¿Qué<br /><span class="text-brand-red">necesitas?</span>
            </h2>
            <p
              class="text-xs font-sans font-bold mt-6 opacity-40 tracking-wider"
            >
              Paso 02 / 04
            </p>
          </div>

          <div id="services-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            {
              [
                "Branding",
                "Web Design",
                "Development",
                "AI Agents",
                "Consultoría",
                "Social Content",
              ].map((service) => (
                <label class="group relative cursor-pointer">
                  <input
                    type="checkbox"
                    name="servicios"
                    value={service}
                    class="sr-only peer service-checkbox"
                  />
                  <div class="border-2 border-brand-black/10 rounded-full py-6 px-10 transition-all duration-300 peer-checked:bg-brand-red peer-checked:border-brand-red peer-checked:text-white text-center">
                    <span class="text-sm font-sans font-bold tracking-tight">
                      {service}
                    </span>
                  </div>
                </label>
              ))
            }
          </div>
        </section>

        <!-- STEP 3: Presupuesto -->
        <section
          class="step opacity-0 pointer-events-none hidden"
          data-step="3"
        >
          <div class="mb-12">
            <h2
              class="text-5xl md:text-8xl font-sans font-900 tracking-tighter leading-none"
            >
              Rango de<br /><span class="text-brand-red">inversión</span>
            </h2>
            <p
              class="text-xs font-sans font-bold mt-6 opacity-40 tracking-wider"
            >
              Paso 03 / 04
            </p>
          </div>

          <div id="budget-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {
              ["$2k - $5k", "$5k - $10k", "$10k - $20k", "$20k+"].map(
                (range) => (
                  <label class="block cursor-pointer">
                    <input
                      type="radio"
                      name="presupuesto"
                      value={range}
                      class="sr-only peer budget-radio"
                    />
                    <div class="border-2 border-brand-black/10 rounded-full p-8 flex justify-between items-center transition-all duration-300 peer-checked:bg-brand-black peer-checked:text-white">
                      <span class="text-lg font-sans font-bold">{range}</span>
                      <div class="w-6 h-6 rounded-full border-2 border-current flex items-center justify-center">
                        <div class="w-2.5 h-2.5 bg-brand-red rounded-full opacity-0 peer-checked:opacity-100" />
                      </div>
                    </div>
                  </label>
                ),
              )
            }
          </div>
        </section>

        <!-- STEP 4: Referido -->
        <section
          class="step opacity-0 pointer-events-none hidden"
          data-step="4"
        >
          <div class="mb-12">
            <h2
              class="text-5xl md:text-8xl font-sans font-900 tracking-tighter leading-none"
            >
              ¿Quién te<br /><span class="text-brand-red">recomendó?</span>
            </h2>
            <p
              class="text-xs font-sans font-bold mt-6 opacity-40 tracking-wider"
            >
              Paso 04 / 04
            </p>
          </div>

          <div class="space-y-8">
            <input
              type="text"
              name="referido"
              placeholder="Nombre de referido (opcional)"
              class="w-full border-b-2 border-brand-black/10 p-6 bg-transparent font-sans text-2xl outline-none focus:border-brand-red transition-colors"
            />
            <div
              class="bg-brand-black/[0.03] p-10 rounded-3xl border border-brand-black/5"
            >
              <p
                class="text-sm font-sans font-medium opacity-60 leading-relaxed italic"
              >
                * Al enviar este briefing, nuestros agentes IA procesarán la
                información para preparar una propuesta personalizada en menos
                de 24h.
              </p>
            </div>
          </div>
        </section>
      </div>

      <!-- Navigation Buttons -->
      <div
        class="mt-16 flex flex-col md:flex-row justify-between items-center gap-4 relative z-10 w-full"
      >
        <button
          id="prev-btn"
          class="invisible opacity-0 flex items-center justify-center gap-3 font-sans font-bold text-sm hover:text-brand-red transition-all py-5 px-12 rounded-full border border-brand-black/10 w-full md:w-auto order-2 md:order-1"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              d="M15 19l-7-7 7-7"
              stroke-width="2.5"
              stroke-linecap="round"
              stroke-linejoin="round"></path></svg
          >
          Anterior
        </button>
        <button
          id="next-btn"
          class="bg-brand-black text-white px-12 py-5 rounded-full font-sans font-bold text-sm hover:bg-brand-red transition-all flex items-center justify-center gap-4 group shadow-xl shadow-brand-black/10 w-full md:w-auto order-1 md:order-2"
        >
          <span id="next-text">Siguiente</span>
          <svg
            id="next-icon"
            class="w-4 h-4 group-hover:translate-x-1 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              d="M9 5l7 7-7 7"
              stroke-width="2.5"
              stroke-linecap="round"
              stroke-linejoin="round"></path></svg
          >
        </button>
      </div>

      <!-- Error Message -->
      <div
        id="error-msg"
        class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-brand-red text-white px-8 py-3 rounded-full font-sans font-bold text-xs opacity-0 pointer-events-none transition-all duration-300 z-[50]"
      >
        Completa los campos obligatorios para continuar
      </div>
    </div>
  </main>
</Layout>

<script>
  import { gsap } from "gsap";

  let currentStep = 1;
  const totalSteps = 4;

  const progressBar = document.getElementById("progress-bar");
  const prevBtn = document.getElementById("prev-btn");
  const nextBtn = document.getElementById("next-btn");
  const nextText = document.getElementById("next-text");

  function updateStep(direction: number) {
    const prevStepEl = document.querySelector(
      `.step[data-step="${currentStep}"]`,
    ) as HTMLElement;
    currentStep += direction;
    const nextStepEl = document.querySelector(
      `.step[data-step="${currentStep}"]`,
    ) as HTMLElement;

    if (prevStepEl && nextStepEl) {
      const tl = gsap.timeline();

      // Animación de salida
      tl.to(prevStepEl, {
        opacity: 0,
        y: direction > 0 ? -30 : 30,
        duration: 0.4,
        ease: "power2.inOut",
        onComplete: () => {
          prevStepEl.style.display = "none";
          prevStepEl.classList.add("pointer-events-none");
        },
      });

      // Animación de entrada
      tl.fromTo(
        nextStepEl,
        {
          opacity: 0,
          y: direction > 0 ? 30 : -30,
          display: "block",
        },
        {
          opacity: 1,
          y: 0,
          duration: 0.5,
          ease: "power3.out",
          onStart: () => {
            nextStepEl.classList.remove("pointer-events-none");
          },
        },
        "-=0.2",
      );
    }

    // Actualizar Progreso
    if (progressBar)
      gsap.to(progressBar, {
        width: `${(currentStep / totalSteps) * 100}%`,
        duration: 0.7,
        ease: "power2.inOut",
      });

    // Visibilidad Botón Anterior
    if (currentStep === 1) {
      gsap.to(prevBtn, {
        autoAlpha: 0,
        x: -10,
        duration: 0.3,
      });
    } else {
      gsap.to(prevBtn, {
        autoAlpha: 1,
        x: 0,
        duration: 0.3,
        visibility: "visible",
      });
    }

    // Texto Botón Siguiente
    if (currentStep === totalSteps) {
      if (nextText) nextText.innerText = "Enviar briefing";
    } else {
      if (nextText) nextText.innerText = "Siguiente";
    }
  }

  nextBtn?.addEventListener("click", () => {
    if (currentStep < totalSteps) {
      updateStep(1);
    } else {
      // Feedback visual antes del envío
      gsap.to(nextBtn, { scale: 0.95, duration: 0.1, yoyo: true, repeat: 1 });
      setTimeout(() => {
        alert("¡Recibido! Nuestros agentes están procesando tu briefing.");
        window.location.href = "/";
      }, 300);
    }
  });

  prevBtn?.addEventListener("click", () => {
    if (currentStep > 1) {
      updateStep(-1);
    }
  });

  // Inicialización limpia
  document.addEventListener("astro:page-load", () => {
    currentStep = 1;
    const allSteps = document.querySelectorAll(
      ".step",
    ) as NodeListOf<HTMLElement>;
    allSteps.forEach((s, i) => {
      if (i === 0) {
        s.style.display = "block";
        s.style.opacity = "1";
        s.classList.remove("pointer-events-none");
      } else {
        s.style.display = "none";
        s.style.opacity = "0";
        s.classList.add("pointer-events-none");
      }
    });

    if (progressBar) progressBar.style.width = `${(1 / totalSteps) * 100}%`;
    if (prevBtn) gsap.set(prevBtn, { autoAlpha: 0 });
  });
</script>

<style>
  .font-900 {
    font-weight: 900;
  }
  .tracking-tighter {
    letter-spacing: -0.05em;
  }
</style>
