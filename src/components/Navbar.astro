---
import AnimatedLogo from "./AnimatedLogo.astro";

const links = [
    { name: "Archivo", href: "/#log" },
    { name: "Tarifas", href: "/#tarifas" },
    { name: "Operaciones", href: "/#core" },
    { name: "Contacto", href: "/#sync" },
];

// Get current path for active state detection
const currentPath = Astro.url.pathname;
---

<nav
    class="fixed top-0 left-0 w-full bg-brand-gray z-50 border-b-[3px] border-brand-red h-20 md:h-24 flex items-center"
>
    <div
        class="max-w-[1440px] mx-auto w-full flex items-center justify-between px-6"
    >
        <!-- Brand Identity Section -->
        <a
            href="/"
            class="flex items-center group relative z-[60]"
            aria-label="Humanoides & Asociados Home"
        >
            <div class="flex items-center">
                <!-- Mobile: Full Logo (smaller) -->
                <div class="block md:hidden w-12 transition-all">
                    <AnimatedLogo
                        mode="static"
                        variant="iso"
                        color="var(--color-brand-red)"
                    />
                </div>
                <!-- Tablet/Desktop: Full Logo -->
                <div
                    class="hidden md:block w-60 lg:w-50 transition-all duration-300"
                >
                    <AnimatedLogo
                        mode="static"
                        variant="full"
                        color="var(--color-brand-red)"
                        align="left"
                    />
                </div>
            </div>
        </a>

        <!-- Main Navigation -->
        <div class="flex items-center gap-3 sm:gap-6 md:gap-10">
            {
                links.map((link) => (
                    <a
                        href={link.href}
                        class="nav-link group relative font-sans text-[10px] sm:text-xs md:text-sm uppercase tracking-[0.15em] sm:tracking-[0.2em] font-bold text-brand-red"
                        data-target={link.href.replace("/#", "")}
                    >
                        {link.name}
                        <div class="nav-underline absolute -bottom-2 left-0 h-[3px] bg-brand-red transition-all duration-300 w-0 group-hover:w-full" />
                    </a>
                ))
            }
        </div>
    </div>
</nav>

<style>
    nav {
        transition: all 0.3s ease;
    }
    .nav-link.active .nav-underline {
        width: 100% !important;
    }
</style>

<script>
    // ScrollSpy Logic
    const sections = document.querySelectorAll("section");
    const navLinks = document.querySelectorAll(".nav-link");

    const observerOptions = {
        root: null,
        rootMargin: "-50% 0px -50% 0px", // Trigger when section is in middle of viewport
        threshold: 0,
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                const id = entry.target.getAttribute("id");
                if (!id) return;

                navLinks.forEach((link) => {
                    link.classList.remove("active");
                    if (link.getAttribute("data-target") === id) {
                        link.classList.add("active");
                    }
                });
            }
        });
    }, observerOptions);

    sections.forEach((section) => observer.observe(section));
</script>
