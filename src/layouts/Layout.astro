---
import { ClientRouter } from "astro:transitions";
import "../styles/global.css";
import Navbar from "../components/Navbar.astro";

interface Props {
	title?: string;
}

const { title = "HA" } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon-animated.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>

		<!-- Google Fonts: Inter & Anek Malayalam -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Anek+Malayalam:wght@300;400;700&family=Inter:wght@400;500;600&family=Kode+Mono:wght@400;700&display=swap"
			rel="stylesheet"
		/>

		<ClientRouter />
	</head>
	<body class="min-h-screen">
		<Navbar />
		<slot />

		<script is:inline src="https://unpkg.com/lenis@1.1.20/dist/lenis.min.js"
		></script>
		<script is:inline>
			const lenis = new Lenis({
				duration: 1.2,
				easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
				direction: "vertical",
				gestureDirection: "vertical",
				smoothMultiplier: 1,
			});

			function raf(time) {
				lenis.raf(time);
				requestAnimationFrame(raf);
			}

			requestAnimationFrame(raf);

			document.addEventListener("astro:after-swap", () => {
				lenis.scrollTo(0, { immediate: true });
			});

			// Anchor Link Smooth Scroll
			document.addEventListener("click", (e) => {
				const anchor = e.target.closest('a[href^="/#"]');
				if (anchor) {
					const href = anchor.getAttribute("href");
					const targetId = href.split("#")[1];
					const targetElement = document.getElementById(targetId);
					if (targetElement) {
						e.preventDefault();
						lenis.scrollTo(targetElement, {
							offset: -100, // Offset for fixed navbar
							duration: 1.5,
						});
						// Update URL without jump
						history.pushState(null, null, href);
					}
				}
			});
		</script>
	</body>
</html>
