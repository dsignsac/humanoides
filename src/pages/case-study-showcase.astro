---
import Layout from "../layouts/Layout.astro";

const caseStudy = {
  client: "Melbourne Pisco",
  title: "Technical Report: Exporting Heritage",
  description:
    "Gestión integral de marca y sincronización operativa para la exportación de destilados premium al mercado australiano. Consolidación de identidad visual y digital 360.",
  meta: {
    id: "MP-2023-AU",
    sector: "Spirits / Premium B2B",
    version: "v1.0.4",
    status: "Operational",
  },
  slides: [
    {
      id: "slide-01",
      label: "Project Identity",
      type: "hero",
      title: "Technical Report: Exporting Heritage",
      client: "Melbourne Pisco",
      service: "Strategy & Sync",
      description:
        "Gestión integral de marca y sincronización operativa para la exportación de destilados premium al mercado australiano. Consolidación de identidad visual y digital 360.",
      tags: [
        "Branding",
        "Copywriting",
        "Web Design",
        "Art Direction",
        "Merchandising",
      ],
      mobileGalleryIndices: [0, 1],
    },
    {
      id: "slide-02",
      label: "01. Intervention",
      type: "tasks",
      items: [
        {
          title: "Cultural Gap",
          solution:
            "Narrativa visual dual: herencia peruana + minimalismo australiano.",
        },
        {
          title: "Voice Consistency",
          solution:
            "Sincronización 360: Website, redes y packaging unificados.",
        },
        {
          title: "B2B Friction",
          solution: "Digitalización total y plataforma educativa dedicada.",
        },
      ],
      mobileGalleryIndices: [2, 3],
    },
    {
      id: "slide-03",
      label: "02. Methodology",
      type: "process",
      items: [
        {
          code: "Aud-01",
          name: "Market Audit",
          desc: "Análisis de sector licores premium en Australia.",
        },
        {
          code: "Brn-02",
          name: "Brand Core",
          desc: "Rediseño de logotipo y tono de voz corporativo.",
        },
        {
          code: "Web-03",
          name: "Ecosystem Build",
          desc: "Construcción plataforma digital responsive.",
        },
        {
          code: "Ops-04",
          name: "Content Operations",
          desc: "Estrategia continua y dirección de arte.",
        },
      ],
      showSchematic: true,
      mobileGalleryIndices: [4, 5],
    },
  ],
  gallery: [
    {
      type: "image",
      src: "/proyectos/melbourne/01.webp",
      caption: "Ident Hero Visual",
    },
    {
      type: "video",
      src: "https://player.vimeo.com/video/779012594?h=1219c32f8b",
      caption: "Brand Essence Film",
    },
    {
      type: "image",
      src: "/proyectos/melbourne/02.webp",
      caption: "Web Experience v1",
    },
    {
      type: "video",
      src: "https://player.vimeo.com/video/779011006?h=f71225fe9c",
      caption: "Product Motion",
    },
    {
      type: "image",
      src: "/proyectos/melbourne/05.webp",
      caption: "Social Strategy",
    },
    {
      type: "image",
      src: "/proyectos/melbourne/06.webp",
      caption: "Packaging Specs",
    },
  ],
};
---

<Layout title={`RE: ${caseStudy.client} // Humanoides`}>
  <main
    class="min-h-screen bg-transparent text-[#D4DAD3] pb-0 selection:bg-brand-red selection:text-white"
  >
    <!-- PROJECT THEMED AREA -->
    <div
      class="project-area w-full transition-colors duration-700"
      style="background-color: #1A1A1A; color: #D4DAD3; --p-contraste: #FF3E00; --p-textos: #D4DAD3; --p-logos: #FF3E00;"
    >
      <!-- Desktop Layout (Hidden on Mobile) -->
      <div class="hidden md:flex flex-col md:flex-row h-screen overflow-hidden">
        <!-- Left Panel: Context & Data -->
        <aside
          id="data-aside"
          class="w-full md:w-5/12 h-[40vh] md:h-full flex flex-col justify-center border-r border-[#333] relative z-20 bg-brand-gray"
        >
          <!-- Scrollable Content Container -->
          <div
            class="md:col-span-5 md:sticky md:top-0 md:h-screen md:max-h-screen overflow-x-auto overflow-y-hidden bg-transparent snap-x snap-mandatory scrollbar-hide"
          >
            <div class="flex h-full w-max relative">
              {
                caseStudy.slides.map((slide) => (
                  <section
                    id={slide.id}
                    class="w-[calc(83.33vw-48px)] md:w-[calc((min(1440px,100vw)-48px)*5/12)] h-screen snap-start pl-0 pr-12 py-12 flex flex-col justify-center space-y-12"
                  >
                    <div>
                      <span class="block text-sm font-bold tracking-[0.3em] mb-4 text-brand-red">
                        {slide.label}
                      </span>

                      {slide.type === "hero" && (
                        <>
                          <h1 class="text-4xl md:text-5xl lg:text-7xl font-sans font-800 leading-[0.85] tracking-tighter text-[var(--p-textos)] border-none overflow-hidden">
                            {slide.title?.split(" ").map((word) => (
                              <span class="inline-block overflow-hidden mr-[0.2em] last:mr-0">
                                <span class="inline-block">{word}</span>
                              </span>
                            ))}
                          </h1>
                          <div class="grid grid-cols-2 gap-8 py-8 border-y border-[var(--p-contraste)]/20 mt-12">
                            <div>
                              <h3 class="text-[10px] tracking-widest mb-2 text-[var(--p-contraste)]">
                                Cliente
                              </h3>
                              <p class="font-sans text-sm font-bold  tracking-wider">
                                {slide.client}
                              </p>
                            </div>
                            <div>
                              <h3 class="text-[10px] tracking-widest mb-2 text-[var(--p-contraste)]">
                                Servicio
                              </h3>
                              <p class="font-sans text-sm font-bold  tracking-wider">
                                {slide.service}
                              </p>
                            </div>
                          </div>
                          <p class="text-xl font-sans font-300 leading-snug opacity-80 max-w-sm mt-8">
                            {slide.description}
                          </p>
                          <div class="flex gap-2 flex-wrap max-w-sm mt-8">
                            {slide.tags?.map((tech) => (
                              <span class="px-3 py-1 border border-[var(--p-contraste)]/30 text-[var(--p-contraste)] text-[10px] tracking-widest  rounded-full">
                                {tech}
                              </span>
                            ))}
                          </div>
                        </>
                      )}

                      {slide.type === "tasks" && (
                        <div class="space-y-6 overflow-y-auto pr-4 custom-scrollbar max-h-[70vh]">
                          {(slide.items as any[])?.map(
                            (item: any, index: number) => (
                              <div class="p-6 border border-white/5 bg-transparent transition-colors group">
                                <span class="text-[10px] text-brand-red opacity-50 block mb-2 font-bold  tracking-widest">
                                  Task 0{index + 1}
                                </span>
                                <h4 class="text-xl font-bold tracking-tight mb-2 ">
                                  {item.title}
                                </h4>
                                <p class="text-sm leading-relaxed font-sans">
                                  {item.solution}
                                </p>
                              </div>
                            ),
                          )}
                        </div>
                      )}

                      {slide.type === "process" && (
                        <div class="space-y-6">
                          <div class="space-y-6 mb-8 pt-4">
                            {(slide.items as any[])?.map((step: any) => (
                              <div class="flex gap-6 items-start process-step-item">
                                <span class="text-[12px] font-bold text-brand-red">
                                  {step.code}
                                </span>
                                <div>
                                  <h4 class="text-base font-bold tracking-tight  mb-1">
                                    {step.name}
                                  </h4>
                                  <p class="text-sm opacity-50 leading-tight font-sans">
                                    {step.desc}
                                  </p>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {slide.type === "image" && (
                        <div class="relative w-full aspect-square md:aspect-[4/5] overflow-hidden border border-white/5">
                          <img
                            src={(slide as any).src}
                            alt={slide.label}
                            class="w-full h-full object-cover"
                          />
                          {(slide as any).caption && (
                            <div class="absolute bottom-4 left-4 bg-black/50 backdrop-blur-sm p-3 border-l-2 border-brand-red">
                              <p class="text-[10px]  tracking-widest">
                                {(slide as any).caption}
                              </p>
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  </section>
                ))
              }
            </div>
          </div>
        </aside>

        <!-- Right Panel: Visual Gallery -->
        <main
          id="gallery-right"
          class="w-full md:w-7/12 h-[60vh] md:h-screen overflow-y-auto scrollbar-hide snap-y snap-mandatory bg-brand-gray"
        >
          <div class="flex flex-col pt-24">
            {
              caseStudy.gallery.map((item, index) => (
                <div class="w-full border-b border-white/5 last:border-0 group relative snap-start">
                  {item.type === "image" ? (
                    <img
                      src={item.src}
                      class="w-full h-auto object-cover block"
                      alt={`${caseStudy.title} - ${index}`}
                      loading="lazy"
                    />
                  ) : (
                    <div class="w-full aspect-video bg-black/10 overflow-hidden">
                      <iframe
                        src={item.src}
                        class="w-full h-full"
                        style="width: 100%; height: 100%;"
                        allow="autoplay; fullscreen; picture-in-picture"
                        allowfullscreen
                      />
                    </div>
                  )}
                  <div class="absolute bottom-4 left-4 md:bottom-8 md:left-8 opacity-0 group-hover:opacity-100 transition-opacity duration-500 bg-brand-black/80 backdrop-blur-sm px-4 py-2 border-l-2 border-brand-red pointer-events-none">
                    <span class="text-[10px] font-mono tracking-widest text-white uppercase">
                      {item.caption}
                    </span>
                  </div>
                </div>
              ))
            }
          </div>
        </main>
      </div>

      <!-- Mobile Layout (Visible on Mobile) -->
      <div class="block md:hidden pb-24">
        {
          caseStudy.slides.map((slide) => (
            <div class="flex flex-col">
              <!-- Slide Content -->
              <section class="px-6 py-16 border-b border-white/5">
                  <span class="block text-xs font-bold tracking-[0.3em] mb-6 text-brand-red">
                    {slide.label}
                  </span>

                  {slide.type === "hero" && (
                    <>
                      <h1 class="text-5xl font-sans font-800 leading-[0.9] tracking-tighter text-[var(--p-textos)] mb-8">
                        {slide.title}
                      </h1>
                      <div class="grid grid-cols-2 gap-4 py-6 border-y border-[var(--p-contraste)]/20 mb-8">
                        <div>
                          <h3 class="text-[10px] tracking-widest mb-1 text-[var(--p-contraste)] opacity-70">
                            Cliente
                          </h3>
                          <p class="font-sans text-xs font-bold tracking-wider">
                            {slide.client}
                          </p>
                        </div>
                        <div>
                          <h3 class="text-[10px] tracking-widest mb-1 text-[var(--p-contraste)] opacity-70">
                            Servicio
                          </h3>
                          <p class="font-sans text-xs font-bold tracking-wider">
                            {slide.service}
                          </p>
                        </div>
                      </div>
                      <p class="text-lg font-sans font-300 leading-snug opacity-80 mb-8">
                        {slide.description}
                      </p>
                      <div class="flex gap-2 flex-wrap">
                        {slide.tags?.map((tech) => (
                          <span class="px-3 py-1 border border-[var(--p-contraste)]/30 text-[var(--p-contraste)] text-[10px] tracking-widest rounded-full">
                            {tech}
                          </span>
                        ))}
                      </div>
                    </>
                  )}

                  {slide.type === "tasks" && (
                    <div class="space-y-4">
                      {(slide.items as any[])?.map((item: any, index: number) => (
                        <div class="p-5 border border-white/5 bg-white/[0.02]">
                          <span class="text-[10px] text-brand-red opacity-60 block mb-2 font-bold tracking-widest">
                            Task 0{index + 1}
                          </span>
                          <h4 class="text-lg font-bold tracking-tight mb-2">
                            {item.title}
                          </h4>
                          <p class="text-sm leading-relaxed opacity-70 font-sans">
                            {item.solution}
                          </p>
                        </div>
                      ))}
                    </div>
                  )}

                  {slide.type === "process" && (
                    <div class="space-y-6">
                      <div class="space-y-6">
                        {(slide.items as any[])?.map((step: any) => (
                          <div class="flex gap-4 items-start">
                            <span class="text-[11px] font-bold text-brand-red mt-1">
                              {step.code}
                            </span>
                            <div>
                              <h4 class="text-sm font-bold tracking-tight mb-1">
                                {step.name}
                              </h4>
                              <p class="text-xs opacity-60 leading-normal font-sans">
                                {step.desc}
                              </p>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
              </section>

              <!-- Interleaved Gallery Images -->
              {(slide as any).mobileGalleryIndices && (
                <div class="flex flex-col">
                  {((slide as any).mobileGalleryIndices as number[]).map((galleryIndex) => {
                    const item = caseStudy.gallery[galleryIndex];
                    if (!item) return null;
                    return (
                      <div class="w-full border-b border-white/5 last:border-0 relative">
                        {item.type === "image" ? (
                          <img
                            src={item.src}
                            class="w-full h-auto object-cover block"
                            alt={item.caption}
                            loading="lazy"
                          />
                        ) : (
                           <div class="w-full aspect-video bg-black/10 overflow-hidden">
                              <iframe
                                src={item.src}
                                class="w-full h-full"
                                style="width: 100%; height: 100%;"
                                allow="autoplay; fullscreen; picture-in-picture"
                                allowfullscreen
                              />
                            </div>
                        )}
                        {item.caption && (
                           <div class="px-6 py-3 border-l-2 border-brand-red bg-brand-gray/50 backdrop-blur-sm absolute bottom-4 left-4">
                              <p class="text-[10px] tracking-widest uppercase">{item.caption}</p>
                           </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          ))
        }
      </div>
    </div>

    <script>
      import { gsap } from "gsap";
      import { ScrollTrigger } from "gsap/ScrollTrigger";

      gsap.registerPlugin(ScrollTrigger);

      const initBrutalistCase = () => {
        const aside = document.getElementById("data-aside");
        const gallery = document.getElementById("gallery-right");
        
        // GSAP MatchMedia for Responsive Logic
        let mm = gsap.matchMedia();

        mm.add("(min-width: 768px)", () => {
          // --- DESKTOP LOGIC (Scroll Sync) ---
          if (!aside || !gallery) return;

          ScrollTrigger.create({
            trigger: gallery,
            scroller: gallery, // Self-scroll container
            start: "top top",
            end: "bottom bottom",
            scrub: true, // Smooth scrub
            onUpdate: (self) => {
              const progress = self.progress;
              // Discrete jumps: 3 slides -> thresholds at ~0.33 and ~0.66
              let activeIndex = 0;
              if (progress > 0.3) activeIndex = 1;
              if (progress > 0.7) activeIndex = 2;

              // Apply discrete scroll
              aside.scrollLeft = activeIndex * (aside.scrollWidth / 3);
            },
          });
        });

        mm.add("(max-width: 767px)", () => {
           // --- MOBILE LOGIC (Simple Reveal) ---
           const sections = document.querySelectorAll("section");
           sections.forEach((section) => {
             gsap.from(section, {
               scrollTrigger: {
                 trigger: section,
                 start: "top 85%",
                 toggleActions: "play none none reverse"
               },
               opacity: 0,
               y: 30,
               duration: 0.8,
               ease: "power2.out"
             });
           });
        });
      };

      document.addEventListener("DOMContentLoaded", initBrutalistCase);
      document.addEventListener("astro:after-swap", initBrutalistCase);
    </script>

    <style>
      /* Brutalist Scrollbar Overrides */
      ::-webkit-scrollbar {
        width: 10px;
      }
      ::-webkit-scrollbar-track {
        background: #d4dad3;
      }
      ::-webkit-scrollbar-thumb {
        background: #fa2a2a;
        border-radius: 0;
        border: 2px solid #d4dad3;
      }

      .perspective-1000 {
        perspective: 1000px;
      }
      .transform-style-3d {
        transform-style: preserve-3d;
      }
      .backface-hidden {
        backface-visibility: hidden;
      }

      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.02);
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: var(--p-contraste);
        opacity: 0.3;
      }
    </style>
  </main>
</Layout>
