---
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import heroImage from "../assets/hero_studio.png";
import Archivos from "../components/Archivos.astro";
import Tarifas from "../components/Tarifas.astro";
import Operaciones from "../components/Operaciones.astro";
import Contacto from "../components/Contacto.astro";
import Testimonios from "../components/Testimonios.astro";

import fs from "node:fs";
import path from "node:path";

// Helper for dynamic data folder reading
const getDataFromFolders = (dirPath: string) => {
  const fullPath = path.resolve(dirPath);
  if (!fs.existsSync(fullPath)) return [];

  const folders = fs.readdirSync(fullPath);
  return folders
    .map((folder) => {
      const infoPath = path.join(fullPath, folder, "info.json");
      if (fs.existsSync(infoPath)) {
        try {
          const data = JSON.parse(fs.readFileSync(infoPath, "utf-8"));
          return { ...data, folder };
        } catch (e) {
          console.error(`Error parsing JSON in ${infoPath}`, e);
          return null;
        }
      }
      return null;
    })
    .filter(Boolean)
    .sort((a, b) => (a.order || 99) - (b.order || 99));
};

// Fetch Logos Data
const rawLogos = getDataFromFolders("./public/marcas");
const logos = rawLogos.map((l) => ({
  src: `/marcas/${l.folder}/${l.logo}`,
  alt: l.name,
  href: l.href,
}));
---

<Layout title="Humanoides & Asociados | Creative Operations">
  <main class="w-full bg-brand-gray text-brand-black">
    <!-- Hero Section -->
    <section
      id="hero"
      class="relative w-full h-screen flex flex-col mt-0 bg-brand-black"
    >
      <!-- Background Image -->
      <div class="absolute inset-0 z-0">
        <Image
          src={heroImage}
          alt="Industrial Creative Studio"
          class="w-full h-full object-cover opacity-60 grayscale"
          loading="eager"
          fetchpriority="high"
          quality={65}
          format="webp"
        />
      </div>
      <div class="absolute inset-0 z-[5] bg-brand-black/60"></div>

      <!-- Content -->
      <div
        class="relative z-10 flex-1 flex flex-col justify-center items-center pt-20 md:pt-24 lg:pt-32 pb-32 md:pb-48"
      >
        <div class="max-w-[1440px] w-full text-center md:text-right px-6">
          <h1
            class="font-sans font-900 text-brand-red mb-6 md:mb-12"
            style="font-size: clamp(3.5rem, 12vw, 180px); line-height: .9; letter-spacing: -0.04em;"
          >
            Make Internet <br />Work Again
          </h1>
          <p
            class="text-xl md:text-3xl lg:text-4xl lg:leading-[1.1] font-500 max-w-md md:max-w-3xl mx-auto md:mx-0 md:ml-auto text-brand-gray mb-6 md:mb-8"
          >
            Diseñamos y lanzamos productos digitales con criterio lógico,
            estético y narrativo.
          </p>
          <div class="flex justify-center md:justify-end mb-12 md:mb-0">
            <a
              href="https://calendly.com/humanoidesyasociados/sync"
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-3 px-10 py-5 bg-[#C41E1E] text-white text-sm font-bold uppercase tracking-[0.2em] hover:bg-brand-black transition-all duration-300 rounded-full group"
            >
              <span>EMPEZAR PROYECTO</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Logo Marquee Banner -->
      <div
        class="absolute bottom-0 left-0 w-full bg-brand-red py-6 md:py-10 z-20 overflow-hidden"
      >
        <div class="flex marquee-container">
          <div
            class="flex items-center gap-12 md:gap-24 animate-marquee whitespace-nowrap px-6"
          >
            {
              [...logos, ...logos, ...logos].map((logo) => (
                <div class="h-8 md:h-12 w-24 md:w-32 flex-shrink-0 flex items-center justify-center">
                  {logo.href ? (
                    <a
                      href={logo.href}
                      class="w-full h-full block"
                      aria-label={`Visitar sitio web de ${logo.alt}`}
                    >
                      <div
                        class="w-full h-full bg-[#D4DAD3]"
                        style={`
                                                    mask: url(${logo.src}) no-repeat center;
                                                    -webkit-mask: url(${logo.src}) no-repeat center;
                                                    mask-size: contain;
                                                    -webkit-mask-size: contain;
                                                `}
                      />
                    </a>
                  ) : (
                    <div
                      class="w-full h-full bg-[#D4DAD3]"
                      style={`
                                                mask: url(${logo.src}) no-repeat center;
                                                -webkit-mask: url(${logo.src}) no-repeat center;
                                                mask-size: contain;
                                                -webkit-mask-size: contain;
                                            `}
                    />
                  )}
                </div>
              ))
            }
          </div>
          <div
            class="flex items-center gap-12 md:gap-24 animate-marquee whitespace-nowrap px-6"
            aria-hidden="true"
          >
            {
              [...logos, ...logos, ...logos].map((logo) => (
                <div class="h-8 md:h-12 w-24 md:w-32 flex-shrink-0 flex items-center justify-center">
                  {logo.href ? (
                    <a
                      href={logo.href}
                      class="w-full h-full block"
                      aria-label={`Visitar sitio web de ${logo.alt}`}
                    >
                      <div
                        class="w-full h-full bg-[#D4DAD3]"
                        style={`
                                                    mask: url(${logo.src}) no-repeat center;
                                                    -webkit-mask: url(${logo.src}) no-repeat center;
                                                    mask-size: contain;
                                                    -webkit-mask-size: contain;
                                                `}
                      />
                    </a>
                  ) : (
                    <div
                      class="w-full h-full bg-[#D4DAD3]"
                      style={`
                                                mask: url(${logo.src}) no-repeat center;
                                                -webkit-mask: url(${logo.src}) no-repeat center;
                                                mask-size: contain;
                                                -webkit-mask-size: contain;
                                            `}
                    />
                  )}
                </div>
              ))
            }
          </div>
        </div>
      </div>
    </section>

    <!-- PORTFOLIO / ARCHIVOS SECTION -->
    <Archivos />

    <!-- TEAM / OPERACIONES SECTION -->
    <Operaciones />

    <!-- PRICING / TARIFARIO SECTION -->
    <Tarifas />

    <!-- TESTIMONIALS / REGISTRY SECTION -->
    <Testimonios />

    <!-- SYNC / CONTACTO SECTION -->
    <Contacto />
  </main>

  <style is:global>
    /* Marquee Animation */
    .marquee-container {
      /* Mask linear gradients removed for brand compliance */
    }
    @keyframes marquee {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }
    .animate-marquee {
      animation: marquee 25s linear infinite;
      will-change: transform;
    }
  </style>
</Layout>
