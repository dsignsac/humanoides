---
import AnimatedLogo from "./AnimatedLogo.astro";

const links = [
    { name: "Archivo", href: "/#log" },
    { name: "Operaciones", href: "/#core" },
    { name: "Tarifas", href: "/#tarifas" },
    { name: "Contacto", href: "/#sync" },
    { name: "Privacidad", href: "/privacidad" },
];

const socialLinks = [
    {
        name: "Instagram",
        href: "https://instagram.com/humanoidesyasociados",
        icon: "instagram",
    },
    {
        name: "LinkedIn",
        href: "https://linkedin.com/company/humanoides",
        icon: "linkedin",
    },
    { name: "WhatsApp", href: "https://wa.me/something", icon: "whatsapp" },
];
---

<nav
    class="fixed top-0 left-0 w-full bg-brand-gray z-[100] border-b-[3px] border-brand-red h-20 md:h-24 flex items-center"
>
    <div
        class="max-w-[1440px] mx-auto w-full flex items-center justify-between px-6"
    >
        <!-- Brand Identity Section -->
        <a
            href="/"
            class="flex items-center group relative z-[110]"
            aria-label="Humanoides & Asociados Home"
        >
            <div class="flex items-center">
                <!-- Unified Full Logo -->
                <div
                    class="w-48 sm:w-56 md:w-60 lg:w-50 transition-all duration-300"
                >
                    <AnimatedLogo
                        mode="once"
                        variant="full"
                        color="var(--color-brand-red)"
                        align="left"
                    />
                </div>
            </div>
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center gap-6 lg:gap-10">
            {
                links.slice(0, 4).map((link) => (
                    <a
                        href={link.href}
                        class="nav-link group relative font-sans text-sm uppercase tracking-[0.2em] font-bold text-brand-red"
                        data-target={link.href.replace("/#", "")}
                    >
                        {link.name}
                        <div class="nav-underline absolute -bottom-2 left-0 h-[3px] bg-brand-red transition-all duration-300 w-0 group-hover:w-full" />
                    </a>
                ))
            }
        </div>

        <!-- Mobile Menu Toggle -->
        <button
            id="menu-toggle"
            class="block md:hidden relative z-[110] w-10 h-10 focus:outline-none"
            aria-label="Toggle Menu"
        >
            <div
                class="hamburger-container relative w-full h-full flex flex-col justify-center items-center gap-1.5"
            >
                <span
                    class="hamburger-line w-8 h-[3px] bg-brand-red transition-all duration-300"
                ></span>
                <span
                    class="hamburger-line w-8 h-[3px] bg-brand-red transition-all duration-300"
                ></span>
                <span
                    class="hamburger-line w-8 h-[3px] bg-brand-red transition-all duration-300"
                ></span>
            </div>
        </button>
    </div>

    <!-- Industrial Mobile Menu -->
    <div
        id="mobile-menu"
        class="fixed inset-0 z-[105] pointer-events-none invisible overflow-hidden"
    >
        <!-- Top and Bottom Panels (Industrial Reveal) - Seamless Background -->
        <div
            id="menu-panel-top"
            class="absolute top-0 left-0 w-full h-[50dvh] bg-brand-gray -translate-y-full"
        >
        </div>
        <div
            id="menu-panel-bottom"
            class="absolute bottom-0 left-0 w-full h-[50dvh] bg-brand-gray translate-y-full"
        >
        </div>

        <!-- Menu Content -->
        <div
            class="relative z-10 w-full h-full flex flex-col justify-between px-6 pt-32 pb-12"
        >
            <!-- Centered Navigation Links -->
            <div class="flex-1 flex flex-col justify-center items-center gap-6">
                {
                    links.map((link, i) => (
                        <div class="overflow-hidden">
                            <a
                                href={link.href}
                                class="mobile-nav-link block text-4xl sm:text-7xl font-sans font-900 uppercase tracking-tighter text-brand-black hover:text-brand-red transition-colors translate-y-full will-change-transform"
                            >
                                {link.name}
                            </a>
                        </div>
                    ))
                }
            </div>

            <!-- Menu Footer -->
            <div class="flex flex-col items-center gap-8">
                <!-- Tiny Elegant Social Icons - Static Red -->
                <div
                    class="flex items-center gap-10 opacity-0 mobile-socials translate-y-4"
                >
                    <a
                        href="https://instagram.com/humanoidesyasociados"
                        target="_blank"
                        class="text-brand-red scale-90"
                        aria-label="Instagram"
                    >
                        <svg
                            class="w-6 h-6"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"
                            ></path>
                        </svg>
                    </a>
                    <a
                        href="https://linkedin.com/company/humanoides"
                        target="_blank"
                        class="text-brand-red scale-90"
                        aria-label="LinkedIn"
                    >
                        <svg
                            class="w-6 h-6"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.238 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
                            ></path>
                        </svg>
                    </a>
                    <a
                        href="https://wa.me/something"
                        target="_blank"
                        class="text-brand-red scale-90"
                        aria-label="WhatsApp"
                    >
                        <svg
                            class="w-6 h-6"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.588-5.946 0-6.556 5.332-11.891 11.891-11.891 3.181 0 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.481 8.403 0 6.556-5.332-11.891-11.891 11.891-2.007 0-3.974-.508-5.713-1.472l-6.28 1.69zm11.947-21.814c-5.411 0-9.814 4.403-9.814 9.814 0 2.046.633 4.02 1.83 5.718l-.193.301-1.11 4.053 4.145-1.116.285.169c1.623 1.045 3.513 1.597 5.454 1.597 5.412 0 9.814-4.402 9.814-9.814 0-2.621-1.02-5.085-2.871-6.938-1.852-1.853-4.318-2.871-6.939-2.871zm5.378 12.102c-.295-.148-1.743-.86-2.012-.958-.269-.099-.465-.148-.662.148-.197.296-.761.958-.934 1.155-.172.197-.345.222-.64.074-.295-.148-1.246-.459-2.375-1.465-.877-.782-1.47-1.747-1.642-2.043-.172-.296-.018-.456.13-.604.133-.133.295-.345.443-.517.148-.172.197-.296.295-.494.099-.197.049-.37-.025-.518-.074-.148-.662-1.595-.908-2.187-.239-.575-.483-.497-.662-.505-.171-.007-.367-.008-.563-.008-.197 0-.517.074-.787.37-.27.296-1.032 1.011-1.032 2.467 0 1.456 1.057 2.861 1.205 3.058.148.197 2.081 3.178 5.039 4.457.704.304 1.254.485 1.682.621.706.224 1.349.193 1.858.117.567-.085 1.743-.712 1.989-1.399.246-.687.246-1.278.172-1.399-.074-.121-.269-.197-.564-.346z"
                            ></path>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<style>
    nav {
        transition: all 0.3s ease;
    }
    .nav-link.active .nav-underline {
        width: 100% !important;
    }

    /* Hamburger Lines Transition */
    .menu-open .hamburger-line:nth-child(1) {
        transform: translateY(9px) rotate(45deg);
    }
    .menu-open .hamburger-line:nth-child(2) {
        opacity: 0;
        transform: translateX(10px);
    }
    .menu-open .hamburger-line:nth-child(3) {
        transform: translateY(-9px) rotate(-45deg);
    }
</style>

<script>
    import { gsap } from "gsap";

    document.addEventListener("astro:page-load", () => {
        const toggle = document.querySelector("#menu-toggle");
        const menu = document.querySelector("#mobile-menu");
        const panelTop = document.querySelector("#menu-panel-top");
        const panelBottom = document.querySelector("#menu-panel-bottom");
        const navLinks = document.querySelectorAll(".nav-link");
        const mobileLinks = document.querySelectorAll(".mobile-nav-link");
        const mobileSocials = document.querySelector(".mobile-socials");
        let isOpen = false;

        if (!toggle || !menu || !panelTop || !panelBottom) return;

        // GSAP Timeline for Menu (Industrial Split)
        const menuTl = gsap.timeline({
            paused: true,
            onStart: () => {
                gsap.set(menu, {
                    visibility: "visible",
                    pointerEvents: "auto",
                });
            },
            onReverseComplete: () => {
                gsap.set(menu, { visibility: "hidden", pointerEvents: "none" });
            },
        });

        menuTl
            .to([panelTop, panelBottom], {
                yPercent: 0,
                y: 0,
                duration: 0.8,
                ease: "expo.inOut",
            })
            .to(
                mobileLinks,
                {
                    y: 0,
                    duration: 0.8,
                    stagger: 0.1,
                    ease: "expo.out",
                },
                "-=0.2",
            )
            .to(
                [mobileSocials],
                {
                    opacity: 1,
                    y: 0,
                    duration: 0.4,
                    stagger: 0.1,
                    ease: "power2.out",
                },
                "-=0.6",
            );

        toggle.addEventListener("click", () => {
            isOpen = !isOpen;
            if (isOpen) {
                document.body.classList.add("menu-open", "overflow-hidden");
                menuTl.timeScale(1).play();
            } else {
                document.body.classList.remove("menu-open", "overflow-hidden");
                menuTl.timeScale(2).reverse(); // Very fast industrial exit
            }
        });

        // Close menu on link click
        mobileLinks.forEach((link) => {
            link.addEventListener("click", () => {
                isOpen = false;
                document.body.classList.remove("menu-open", "overflow-hidden");
                menuTl.timeScale(1.5).reverse();
            });
        });

        // ScrollSpy Logic (kept from original)
        const sections = document.querySelectorAll("section");
        const observerOptions = {
            root: null,
            rootMargin: "-50% 0px -50% 0px",
            threshold: 0,
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute("id");
                    if (!id) return;

                    navLinks.forEach((link) => {
                        link.classList.remove("active");
                        if (link.getAttribute("data-target") === id) {
                            link.classList.add("active");
                        }
                    });
                }
            });
        }, observerOptions);

        sections.forEach((section) => observer.observe(section));
    });
</script>
