---
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import heroImage from "../assets/hero_studio.png";
import PortfolioSection from "../components/PortfolioSection.astro";

const logos = [
    { src: "/marcas/ELA.svg", alt: "ELA" },
    { src: "/marcas/dataStream.svg", alt: "Data Stream" },
    { src: "/marcas/hilton.svg", alt: "Hilton" },
    { src: "/marcas/logo.svg", alt: "Logo" },
    { src: "/marcas/monsterlink.svg", alt: "Monsterlink" },
];

const team = [
    { type: 'HUMAN', ref: '01', name: 'David', role: 'Founder & Lead Operator', spec: 'Dirección Estratégica & Creativa', availability: 'ON-SITE', img: '/miembros/chad.png', cv: '#david-cv', desc: 'Lidera la visión del estudio fusionando creatividad humana con potencia artificial.' },
    { type: 'HUMAN', ref: '02', name: 'Eyner', role: 'Technical Director', spec: 'Arquitectura de Sistemas & Lógica', availability: 'ON-SITE', img: '/miembros/chad.png', cv: '#eyner-cv', desc: 'Arquitecto de soluciones complejas y guardián de la integridad técnica.' },
    { type: 'AI', ref: 'S1', name: 'Chad', role: 'Development Agent', spec: 'Síntesis de Código & Debugging', availability: 'SYNCED', img: '/miembros/chad.png', desc: 'Sintetiza arquitecturas complejas y optimiza código en tiempo real.' },
    { type: 'AI', ref: 'S2', name: 'Gemma', role: 'Operations Agent', spec: 'Optimización de Procesos', availability: 'SYNCED', img: '/miembros/gemma.png', desc: 'Coordina flujos de trabajo masivos garantizando entregas impecables.' },
    { type: 'AI', ref: 'S3', name: 'Claudio', role: 'Planning Agent', spec: 'Análisis Predictivo de Datos', availability: 'SYNCED', img: '/miembros/claudio.png', desc: 'Proyecta escenarios futuros mediante el análisis de patrones ocultos.' },
    { type: 'AI', ref: 'S4', name: 'Connie', role: 'Visual Agent', spec: 'Generación Dinámica de Activos', availability: 'SYNCED', img: '/miembros/connie.png', desc: 'Materializa visiones abstractas en activos visuales de alto impacto.' },
];

const humans = [...team.filter(m => m.type === 'HUMAN')].reverse(); // Revertir para el scroll hacia la derecha
const agents = team.filter(m => m.type === 'AI');
---

<Layout title="Humanoides & Asociados | Eficiencia Disruptiva">
    <main class="w-full bg-brand-gray text-brand-black">
        <!-- Hero Section -->
        <section
            id="hero"
            class="relative w-full h-screen flex flex-col mt-0 bg-brand-black"
        >
            <!-- Background Image -->
            <div class="absolute inset-0 z-0">
                <Image
                    src={heroImage}
                    alt="Industrial Creative Studio"
                    class="w-full h-full object-cover opacity-80 grayscale"
                    loading="eager"
                    quality={80}
                    format="webp"
                />
            </div>
            <div class="absolute inset-0 z-[5] bg-brand-black/70"></div>

            <!-- Content -->
            <div
                class="relative z-10 flex-1 flex flex-col justify-center items-center pt-32 md:pt-48 lg:pt-56 xl:pt-64 pb-32 md:pb-48"
            >
                <div
                    class="max-w-[1440px] w-full text-center md:text-right px-6"
                >
                    <h1
                        class="font-sans font-bold text-brand-red mb-6 md:mb-12"
                        style="font-size: clamp(3.5rem, 12vw, 180px); line-height: .9; letter-spacing: -0.04em;"
                    >
                        Make Internet<br />Work Again
                    </h1>
                    <p
                        class="text-xl md:text-[32px] md:leading-[36px] font-500 max-w-md md:max-w-2xl mx-auto md:mx-0 md:ml-auto text-brand-gray mb-8 md:mb-12"
                    >
                        Somos un Profesional y sus Ai-gentes, listos para
                        producir tu próximo éxito digital.
                    </p>
                    <div
                        class="flex justify-center md:justify-end mb-12 md:mb-0"
                    >
                        <a
                            href="#log"
                            class="group relative inline-flex items-center px-8 py-4 bg-transparent border border-brand-gray text-brand-gray font-sans font-800 uppercase tracking-widest text-sm transition-all duration-300 hover:border-brand-red hover:bg-brand-red hover:text-brand-gray overflow-hidden rounded-full"
                        >
                            <span class="relative z-10">Ver Proyectos</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Logo Marquee Banner -->
            <div
                class="absolute bottom-0 left-0 w-full bg-brand-red py-4 md:py-6 z-20 overflow-hidden border-t border-white/10"
            >
                <div class="flex marquee-container">
                    <div
                        class="flex items-center gap-12 md:gap-24 animate-marquee whitespace-nowrap px-6"
                    >
                        {
                            [...logos, ...logos, ...logos].map((logo) => (
                                <div class="h-8 md:h-12 w-24 md:w-32 flex-shrink-0 flex items-center justify-center">
                                    <div
                                        class="w-full h-full bg-[#D4DAD3]"
                                        style={`
                                            mask: url(${logo.src}) no-repeat center;
                                            -webkit-mask: url(${logo.src}) no-repeat center;
                                            mask-size: contain;
                                            -webkit-mask-size: contain;
                                        `}
                                    />
                                </div>
                            ))
                        }
                    </div>
                    <div
                        class="flex items-center gap-12 md:gap-24 animate-marquee whitespace-nowrap px-6"
                        aria-hidden="true"
                    >
                        {
                            [...logos, ...logos, ...logos].map((logo) => (
                                <div class="h-8 md:h-12 w-24 md:w-32 flex-shrink-0 flex items-center justify-center">
                                    <div
                                        class="w-full h-full bg-[#D4DAD3]"
                                        style={`
                                            mask: url(${logo.src}) no-repeat center;
                                            -webkit-mask: url(${logo.src}) no-repeat center;
                                            mask-size: contain;
                                            -webkit-mask-size: contain;
                                        `}
                                    />
                                </div>
                            ))
                        }
                    </div>
                </div>
            </div>
        </section>

        <!-- PORTFOLIO / LOG SECTION -->
        <PortfolioSection />

        <!-- TEAM SECTION (CORE) -->
        <section
            id="core"
            class="relative w-full bg-brand-gray text-brand-black pt-24"
        >
            <div class="max-w-[1440px] mx-auto w-full px-6 relative">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8">
                    <div>
                        <span
                            class="text-sm font-sans uppercase tracking-[0.2em] text-brand-red mb-2 block font-bold"
                            >Corporative Overview</span
                        >
                    </div>
                    <div class="hidden md:block text-right">
                        <span
                            class="text-xs font-sans tracking-widest block text-brand-black font-bold"
                            >STATUS: OPERATIONAL</span
                        >
                        <span
                            class="text-xs font-sans tracking-widest block text-brand-black font-bold"
                            >METRIC: EFFICIENT</span
                        >
                    </div>
                </div>

                <!-- TABLE HEADER (Desktop Only) -->
                <div class="hidden md:grid grid-cols-12 gap-6 md:gap-8 px-6 pb-4 pt-4 mt-8 border-y border-brand-black text-xs font-sans font-900 tracking-widest uppercase text-brand-black">
                    <div class="col-span-2">FOTOGRAFÍA</div>
                    <div class="col-span-4">NOMBRE Y CARGO</div>
                    <div class="col-span-4">AREA</div>
                    <div class="col-span-2 text-right">HOJA DE VIDA</div>
                </div>

                <!-- MIRROR CAROUSEL TEAM SYSTEM (Infinite Drag & Sync) -->
                <div id="team-mirror-system" class="w-full flex flex-col gap-0 select-none cursor-grab active:cursor-grabbing">
                    
                    <div id="human-carousel" class="relative w-full overflow-hidden border-b border-brand-black">
                        <div class="carousel-track flex" style="width: 600%;">
                            {[...humans, ...humans, ...humans].map((member) => (
                                <article class="flex-shrink-0 w-1/6 py-8 md:py-12 px-0 group transition-colors duration-300 hover:bg-brand-salmon relative pointer-events-none">
                                    <div class="flex flex-col md:grid md:grid-cols-12 gap-6 md:gap-8 items-start md:items-center relative z-10 px-6">
                                        <!-- Photo -->
                                        <div class="md:col-span-2">
                                            <div class="w-48 h-48 md:w-36 md:h-36 bg-brand-gray border border-brand-black overflow-hidden mx-0">
                                                <img src={member.img} alt={member.name} class="w-full h-full object-cover object-top" loading="lazy" />
                                            </div>
                                        </div>
                                        <!-- Info -->
                                        <div class="md:col-span-4">
                                            <h3 class="font-sans font-900 uppercase leading-none text-brand-black group-hover:text-brand-red transition-colors" style="font-size: clamp(2.5rem, 8vw, 3.5rem);">
                                                {member.name}
                                            </h3>
                                            <p class="text-sm md:text-xs font-sans mt-2 uppercase tracking-wide font-bold text-brand-black">
                                                {member.role}
                                            </p>
                                        </div>
                                        <!-- Spec -->
                                        <div class="md:col-span-4 font-sans text-base md:text-sm uppercase tracking-wider text-brand-black font-bold">
                                            <p>{member.spec}</p>
                                            <p class="text-xs md:text-[11px] font-medium mt-2 normal-case tracking-normal max-w-sm">{member.desc}</p>
                                        </div>
                                        <!-- Actions -->
                                        <div class="w-full md:col-span-2 flex flex-row md:flex-col justify-end items-center md:items-end gap-4 pointer-events-auto mt-4 md:mt-0">
                                            <a href={member.cv} class="inline-flex items-center px-6 py-3 md:px-8 md:py-4 bg-brand-black text-[#D4DAD3] text-xs md:text-sm font-900 uppercase tracking-widest hover:bg-brand-red transition-colors z-20 whitespace-nowrap">
                                                Ver Hoja de Vida
                                            </a>
                                        </div>
                                    </div>
                                </article>
                            ))}
                        </div>
                    </div>

                    <!-- 2. AGENTS CAROUSEL (Sliding LEFT) -->
                    <div id="agent-carousel" class="relative w-full overflow-hidden bg-brand-gray">
                        <div class="carousel-track flex" style="width: 600%;">
                            {[...agents, ...agents, ...agents].map((member) => (
                                <article class="flex-shrink-0 w-1/12 py-6 md:py-8 px-0 group transition-colors duration-300 hover:bg-brand-salmon relative pointer-events-none">
                                    <div class="grid grid-cols-1 gap-4 items-start px-6">
                                        <div class="flex items-center gap-4">
                                            <div class="w-24 h-24 md:w-20 md:h-20 flex-shrink-0 bg-brand-gray border border-brand-black overflow-hidden">
                                                <img src={member.img} alt={member.name} class="w-full h-full object-cover object-top" loading="lazy" />
                                            </div>
                                            <div>
                                                <h3 class="font-sans font-700 text-xl md:text-xl uppercase leading-none text-brand-black group-hover:text-brand-red transition-colors">
                                                    {member.name}
                                                </h3>
                                                <span class="text-[10px] md:text-[9px] font-sans font-900 text-brand-black uppercase tracking-widest block mt-1">
                                                    {member.type}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="min-h-[80px] md:min-h-[60px]">
                                            <p class="text-[11px] md:text-[10px] font-sans font-semibold uppercase text-brand-black/60">
                                                {member.role}
                                            </p>
                                            <p class="text-[12px] md:text-[11px] font-sans text-brand-black font-medium px-0 leading-tight">
                                                {member.desc}
                                            </p>
                                        </div>
                                    </div>
                                </article>
                            ))}
                        </div>
                    </div>
                </div>

                <script>
                    import { gsap } from 'gsap';

                    function initMirrorSystem() {
                        const system = document.getElementById('team-mirror-system');
                        const humanTrack = document.querySelector('#human-carousel .carousel-track') as HTMLElement;
                        const agentTrack = document.querySelector('#agent-carousel .carousel-track') as HTMLElement;
                        if (!system || !humanTrack || !agentTrack) return;

                        // Configuration
                        const cycleSize = 100 / 3; // 33.333% (One full set of unique items)
                        const humanSlideSize = cycleSize / 2; // 2 items per set
                        const agentSlideSize = cycleSize / 4; // 4 items per set
                        
                        // State
                        let virtualX = 0; // Coordinate in PERCENTAGE
                        let isDragging = false;
                        let startX = 0;
                        let startVirtualX = 0;
                        let autoTimer: any;

                        function update(immediate = false) {
                            const wrappedX = gsap.utils.wrap(-cycleSize, 0, virtualX);
                            
                            const humanX = -33.3333 + wrappedX;
                            const agentX = -33.3333 - wrappedX;

                            gsap.to(humanTrack, {
                                xPercent: humanX,
                                duration: immediate ? 0 : 1.2,
                                ease: immediate ? "none" : "power3.out"
                            });
                            gsap.to(agentTrack, {
                                xPercent: agentX,
                                duration: immediate ? 0 : 1.2,
                                ease: immediate ? "none" : "power3.out"
                            });
                        }

                        // Initialize
                        update(true);

                        function onDragStart(e: any) {
                            isDragging = true;
                            startX = (e.type === 'touchstart') ? e.touches[0].clientX : e.clientX;
                            startVirtualX = virtualX;
                            clearInterval(autoTimer);
                            system?.classList.add('cursor-grabbing');
                        }

                        function onDrag(e: any) {
                            if (!isDragging) return;
                            const x = (e.type === 'touchmove') ? e.touches[0].clientX : e.clientX;
                            // Sensitivity: How many pixels move the carousel by 1%?
                            // Let's say 30px = 1%
                            const delta = (x - startX) / 30;
                            virtualX = startVirtualX + delta;
                            update(true);
                        }

                        function onDragEnd() {
                            if (!isDragging) return;
                            isDragging = false;
                            system?.classList.remove('cursor-grabbing');
                            
                            // Snap to nearest human slide to keep David aligned
                            const snap = humanSlideSize;
                            virtualX = Math.round(virtualX / snap) * snap;
                            
                            update();
                            startAuto();
                        }

                        system.addEventListener('mousedown', onDragStart);
                        window.addEventListener('mousemove', onDrag);
                        window.addEventListener('mouseup', onDragEnd);
                        
                        system.addEventListener('touchstart', onDragStart, { passive: true });
                        window.addEventListener('touchmove', onDrag, { passive: false });
                        window.addEventListener('touchend', onDragEnd);

                        function startAuto() {
                            clearInterval(autoTimer);
                            autoTimer = setInterval(() => {
                                virtualX -= humanSlideSize; // Move forward (items slide left relative to world)
                                update();
                            }, 5000);
                        }

                        startAuto();
                    }

                    document.addEventListener('astro:page-load', initMirrorSystem);
                    if (document.readyState === 'complete') initMirrorSystem();
                </script>
            </div>
            <style>
                .marquee-container {
                    mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
                    -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
                }
            </style>
        </section>
    </main>
</Layout>
